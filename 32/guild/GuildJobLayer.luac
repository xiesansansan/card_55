slot0 = class("GuildJobLayer", require("common.BaseLayer"), function ()
	return UIWrap.newRootLayer({
		fullScreen = true
	})
end)
slot0.uiTree = {
	{
		name = "untitled1",
		cType = "Sprite",
		params = {
			isFullScale = true,
			scaleApt = 2,
			posApt = 1,
			image = "bp_39.png",
			pos = {
				x = 568,
				y = 320
			}
		},
		children = {}
	},
	{
		name = "centerNode",
		cType = "Node",
		params = {
			posApt = 1,
			scaleApt = 2,
			pos = {
				x = 568,
				y = 320
			}
		},
		children = {
			{
				name = "warningLabel",
				cType = "Label",
				params = {
					text = "Label",
					emptyInit = true,
					isRichText = true,
					anchor = {
						x = 0,
						y = 0.5
					},
					color = {
						g = 37,
						r = 37,
						b = 37
					},
					pos = {
						x = -358.34,
						y = 213.68
					}
				},
				children = {}
			},
			{
				name = "untitled9",
				cType = "Sprite",
				params = {
					image = "bp_36.png",
					pos = {
						x = 59,
						y = -90
					}
				},
				children = {}
			},
			{
				name = "untitled10",
				cType = "Sprite",
				params = {
					image = "bp_79.png",
					pos = {
						x = 63.99,
						y = 134.76
					}
				},
				children = {}
			},
			{
				name = "untitled12",
				cType = "Sprite",
				params = {
					image = "bp_38.png",
					pos = {
						x = 59.84,
						y = 212.16
					}
				},
				children = {}
			},
			{
				name = "posNode",
				cType = "TemplateNode",
				custom = {
					{
						value = "untitled16-text",
						name = "posNameStr",
						type = "string"
					},
					{
						value = "untitled24-subKey",
						name = "redSubKey",
						type = "string"
					},
					{
						value = "untitled29-image",
						name = "borderPic",
						type = "string"
					}
				},
				params = {
					pos = {
						x = -166,
						y = 122.78
					},
					size = {
						width = 35,
						height = 35
					}
				},
				children = {
					{
						name = "playerCard",
						cType = "CardNode",
						params = {
							clickAction = "onClickHead",
							allowClick = true,
							pos = {
								x = 0,
								y = 0
							}
						},
						children = {}
					},
					{
						name = "nameLabel",
						cType = "Label",
						params = {
							text = "",
							color = {
								g = 65,
								r = 192,
								b = 65
							},
							outlineColor = {
								g = 37,
								r = 37,
								b = 37
							},
							pos = {
								x = 0,
								y = -52
							}
						},
						children = {}
					},
					{
						name = "untitled29",
						cType = "Sprite",
						params = {
							image = "bp_103.png",
							pos = {
								x = 0.55,
								y = 54.91
							}
						},
						children = {}
					},
					{
						name = "untitled15",
						cType = "Sprite",
						params = {
							image = "bp_37.png",
							pos = {
								x = 0,
								y = 54
							}
						},
						children = {
							{
								name = "untitled16",
								cType = "Label",
								params = {
									pos = {
										x = 42.5,
										y = 11.5
									},
									text = TR("职位")
								},
								children = {}
							}
						}
					},
					{
						name = "emptySprite",
						cType = "Sprite",
						params = {
							image = "bp_78.png",
							pos = {
								x = 0,
								y = 0
							}
						},
						children = {}
					}
				}
			},
			{
				name = "untitled20",
				cType = "Sprite",
				params = {
					image = "bp_80.png",
					pos = {
						x = -169.64,
						y = 29
					}
				},
				children = {}
			},
			{
				name = "untitled18",
				cType = "Sprite",
				params = {
					image = "bp_80.png",
					pos = {
						x = -169.64,
						y = -144
					}
				},
				children = {}
			},
			{
				name = "untitled21",
				cType = "Sprite",
				params = {
					image = "bp_80.png",
					pos = {
						x = 299,
						y = 29
					}
				},
				children = {}
			},
			{
				name = "untitled19",
				cType = "Sprite",
				params = {
					image = "bp_80.png",
					pos = {
						x = 299,
						y = -144
					}
				},
				children = {}
			},
			{
				name = "untitled23",
				cType = "Sprite",
				params = {
					image = "bp_34.png",
					pos = {
						x = -356.44,
						y = 101.26
					}
				},
				children = {}
			},
			{
				name = "untitled22",
				cType = "Sprite",
				params = {
					image = "bp_35.png",
					pos = {
						x = 478.9,
						y = 100.86
					}
				},
				children = {}
			},
			{
				name = "dailyGiftNode",
				cType = "Node",
				params = {
					pos = {
						x = 437.4,
						y = 274.59
					}
				},
				children = {
					{
						name = "untitled31",
						cType = "Scale9Sprite",
						params = {
							image = "c_118.png",
							pos = {
								x = 0,
								y = 0
							},
							size = {
								width = 200,
								height = 35
							}
						},
						children = {
							{
								name = "myPositionLabel",
								cType = "Label",
								params = {
									emptyInit = true,
									pos = {
										x = 100,
										y = 17.5
									},
									text = TR("我的官职：起来了啦")
								},
								children = {}
							}
						}
					},
					{
						name = "dailyGiftBtn",
						cType = "Button",
						params = {
							image = "tb_gn_304.png",
							clickAction = "onGiftBtn",
							pos = {
								x = 0,
								y = -57
							}
						},
						children = {
							{
								name = "untitled32",
								cType = "RedDot",
								params = {
									subKey = "CanReward",
									moduleId = 4614
								},
								children = {}
							}
						}
					}
				}
			}
		}
	},
	{
		name = "untitled25",
		cType = "Node",
		params = {
			posApt = 1,
			scaleApt = 2,
			pos = {
				x = 0,
				y = 640
			}
		},
		children = {
			{
				name = "untitled26",
				cType = "Button",
				params = {
					image = "c_1.png",
					clickAction = "onCloseBtn",
					pos = {
						x = 124.8,
						y = -30
					}
				},
				children = {
					{
						name = "untitled27",
						cType = "Sprite",
						params = {
							image = "bp_26.png",
							pos = {
								x = 50,
								y = 0
							}
						},
						children = {}
					}
				}
			},
			{
				name = "untitled28",
				cType = "Button",
				params = {
					image = "c_3.png",
					clickAction = "onRuleBtn",
					pos = {
						x = 279.74,
						y = -25
					}
				},
				children = {}
			}
		}
	},
	{
		name = "leftNode",
		cType = "Node",
		params = {
			posApt = 1,
			scaleApt = 2,
			isLiuHai = true,
			pos = {
				x = 0,
				y = 320
			}
		},
		children = {
			{
				name = "untitled8",
				cType = "Sprite",
				params = {
					image = "bp_33.png",
					pos = {
						x = 70.16,
						y = -30.44
					}
				},
				children = {}
			},
			{
				name = "btnTabView",
				cType = "TabView",
				params = {
					onSelectChange = "onTabChanged",
					lightedImage = "bp_27.png",
					direction = true,
					normalImage = "bp_28.png",
					btnInfos = {
						{
							title = "Test"
						}
					},
					pos = {
						x = 23.88,
						y = -254.05
					},
					size = {
						width = 104.07,
						height = 500
					}
				},
				children = {}
			}
		}
	}
}
slot0.ctor = function (slot0, slot1)
	slot0.mGuildInfo = PlayerAttrObj:getPlayerAttrByName("GuildInfo")
	slot0.mMySeriesId = slot0.mGuildInfo.PositionSeriesId
	slot0.mCurSeriesId = slot0.mMySeriesId + 1
	slot0.mJobNodeList = {}
	slot0.mPositionInfo = {}

	slot0.super.ctor(slot0)
	slot0.initUI(slot0)
	slot0.requestPositionInfo(slot0)

	return 
end
slot0.initUI = function (slot0)
	slot0.tebBtnInfos = {
		{
			tag = 1,
			titlePic = "bp_109.png",
			title = TR("")
		},
		{
			tag = 2,
			titlePic = "bp_29.png",
			title = TR("")
		},
		{
			tag = 3,
			titlePic = "bp_30.png",
			title = TR("")
		},
		{
			tag = 4,
			titlePic = "bp_31.png",
			title = TR("")
		},
		{
			tag = 5,
			titlePic = "bp_32.png",
			title = TR("")
		}
	}

	slot0.createUITree(slot0, function (slot0, slot1)
		if slot0.name == "btnTabView" then
			slot1.btnInfos = slot0.tebBtnInfos
			slot1.selectTag = slot0.mCurSeriesId
		end

		return 
	end)

	for slot5, slot6 in ipairs(slot1) do
		slot7 = UIWrap.newControl("Sprite", {
			image = slot0.tebBtnInfos[slot5].titlePic
		})

		slot7.setPosition(slot7, 0, 0)
		slot6.addChild(slot6, slot7)

		if slot0.tebBtnInfos[slot5].tag < slot0.mMySeriesId + 1 then
			slot6.setEnabled(slot6, false)
		end
	end

	if Guide.manager:triggerSpecialGuide(8004) then
		slot0.executeGuide(slot0)
	end

	return 
end
slot0.onCloseBtn = function (slot0)
	LayerManager.removeLayer(slot0)

	return 
end
slot0.onTabChanged = function (slot0, slot1)
	slot0.mCurSeriesId = slot1

	slot0.refreshUI(slot0)

	if slot0.mMySeriesId < slot0.mCurSeriesId - 1 then
		slot0.warningLabel:setVisible(true)
		slot0.warningLabel:setString(TR("占领%s%s座%s大型门派解锁", "#258711", GuildPositionConfig.items[slot0.mCurSeriesId - 1].bigCityNumNeed, "#252525"))
	else
		slot0.warningLabel:setVisible(false)
	end

	return 
end
slot0.onRuleBtn = function (slot0)
	ui.showRuleMsg({
		textList = {
			TR("1、帮派官职共分为贡献和战力官职；"),
			TR("2、职位一共分为：帮主、副帮主、长老、护法；"),
			TR("3、帮派官职共分为：无为而治和大权在握 管理方式；"),
			TR("4、无为而治 模式 则是大侠自行进行比拼官职，贡献官职则比拼贡献值，战力官职则比拼战力值；"),
			TR("5、职位分为拥有对应的特权；"),
			TR("6、官职级别会根据帮派占领大型城池的数量升级；"),
			TR("7、升级后对应的官职默认也升级到对应档位；"),
			TR("8、高级别官职将享有更丰厚的官职特权。")
		}
	})

	return 
end
slot1 = {
	cc.p(57, 222),
	cc.p(-166, 123),
	cc.p(300, 123),
	cc.p(-306, -52),
	cc.p(-169, -52),
	cc.p(-32, -52),
	cc.p(163, -52),
	cc.p(300, -52),
	cc.p(437, -52),
	cc.p(-306, -224),
	cc.p(-169, -224),
	cc.p(-32, -224),
	cc.p(163, -224),
	cc.p(300, -224),
	cc.p(437, -224)
}
slot2 = {
	[0] = "bp_110.png",
	"bp_103.png",
	"bp_104.png",
	"bp_106.png",
	"bp_108.png"
}
slot0.refreshUI = function (slot0)
	for slot4, slot5 in ipairs(slot0.mJobNodeList) do
		slot5.removeFromParent(slot5)

		slot5 = nil
	end

	slot0.mJobNodeList = {}

	for slot5, slot6 in ipairs(slot1) do
		slot7 = slot0.createLayoutTemplateNode(slot0, "posNode", {
			posNameStr = slot6.positionName,
			redSubKey = slot0.mCurSeriesId - 1 .. "_" .. slot6.positionId,
			borderPic = slot0[slot0.mCurSeriesId - 1]
		})

		slot7.setPosition(slot7, slot1[slot5])
		slot0.centerNode:addChild(slot7)

		slot7.playerCard.positionId = slot6.positionId

		if slot0.mMySeriesId == slot0.mCurSeriesId - 1 then
			slot0.myPositionLabel:setString(TR("我的官职：%s", (slot0.mGuildInfo.PositionId == 0 and TR("暂无")) or GuildPositionRelation.items[slot0.mMySeriesId][slot0.mGuildInfo.PositionId].positionName))

			if slot0.mPositionInfo[slot5] then
				slot7.emptySprite:setVisible(false)
				slot7.playerCard:setPlayerHeader(slot0.mPositionInfo[slot5].HeadImageId, nil, {
					headPicId = slot0.mPositionInfo[slot5].HeadPicId
				})
				slot7.nameLabel:setString(slot0.mPositionInfo[slot5].Name)

				if slot0.mPositionInfo[slot5].FashionLevel then
					slot7.nameLabel:setColor(Utility.getPlayerNameColor(slot0.mPositionInfo[slot5].FashionLevel, false, true))
				end

				slot7.playerCard.info = slot0.mPositionInfo[slot5]
			end
		end

		slot0.dailyGiftNode:setVisible(slot0.mMySeriesId == slot0.mCurSeriesId - 1)
		table.insert(slot0.mJobNodeList, slot7)
	end

	slot0.refreshBox(slot0)

	return 
end
slot0.onClickHead = function (slot0, slot1)
	LayerManager.addLayer({
		cleanUp = false,
		name = "guild.GuildJobInfoLayer",
		data = {
			posId = slot1.positionId,
			seriesId = slot0.mCurSeriesId - 1,
			positionInfo = slot1.info,
			callBack = function (slot0)
				slot0:requestPositionInfo(true)

				return 
			end
		},
		zOrder = Enums.ZOrderType.ePopLayer
	})

	return 
end
slot0.onGiftBtn = function (slot0)
	if GuildPositionRelation.items[slot0.mMySeriesId][slot0.mGuildInfo.PositionId] then
		if slot1.dailyReward ~= "" then
			slot0.requestGetGuildPositionReward(slot0)
		else
			ui.showFlashView(TR("当前官职没有俸禄可领取"))
		end
	else
		ui.showFlashView(TR("当前官职没有俸禄可领取"))
	end

	return 
end
slot0.refreshBox = function (slot0)
	if slot0.mIsGetPostReward then
		slot0.dailyGiftBtn:loadTextures("tb_gn_305.png", "tb_gn_305.png")
		slot0.dailyGiftBtn:setClickAction(function ()
			ui.showFlashView(TR("已领取过今日奖励"))

			return 
		end)
	else
		slot0.dailyGiftBtn:loadTextures("tb_gn_304.png", "tb_gn_304.png")
	end

	return 
end
slot0.requestPositionInfo = function (slot0, slot1)
	slot0.socketRequest(slot0, {
		methodName = "GetGuildPositionInfo",
		moduleName = "Guild",
		successCallback = function (slot0)
			slot0.mPositionInfo = {}

			for slot4, slot5 in ipairs(slot0.PositionInfo) do
				slot0.mPositionInfo[slot5.PositionId] = slot5
			end

			slot0.mIsGetPostReward = slot0.IsGetPostReward

			slot0.btnTabView:activeTabBtnByTag2(slot0.mCurSeriesId)

			if slot0.btnTabView.activeTabBtnByTag2 then
				slot0:refreshUI()
			end

			return 
		end
	})

	return 
end
slot0.requestGetGuildPositionReward = function (slot0)
	slot0.socketRequest(slot0, {
		methodName = "GetGuildPositionReward",
		moduleName = "Guild",
		successCallback = function (slot0)
			if slot0.BaseGetGameResourceList then
				ui.showFlashReward({
					BaseGetGameResourceList = slot0.BaseGetGameResourceList
				})
			end

			slot0.mIsGetPostReward = true

			slot0:refreshUI()

			return 
		end
	})

	return 
end
slot0.executeGuide = function (slot0)
	Guide.manager:exeGuideList({
		[8004] = {
			clickNode = slot0.btnTabView:getTabBtnByTag(2)
		},
		[800401] = {
			saveStep = true,
			overClose = true,
			clickNode = slot0.btnTabView:getTabBtnByTag(1)
		}
	})

	return 
end

return slot0
