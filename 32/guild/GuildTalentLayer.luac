slot0 = class("GuildTalentLayer", require("common.BaseLayer"), function ()
	return UIWrap.newRootLayer({
		fullScreen = false
	})
end)
slot0.uiTree = {
	{
		name = "untitled5",
		cType = "Sprite",
		params = {
			isFullScale = true,
			scaleApt = 2,
			posApt = 1,
			image = "bz_19.jpg",
			pos = {
				x = 568,
				y = 320
			}
		},
		children = {}
	},
	{
		name = "mFlowersNode",
		cType = "Node",
		params = {
			posApt = 1,
			scaleApt = 2,
			pos = {
				x = 568,
				y = 0
			}
		},
		children = {
			{
				name = "untitled43",
				cType = "Sprite",
				custom = {
					{
						value = 1,
						name = "flowerId",
						type = "integer"
					}
				},
				params = {
					image = "bz_34.png",
					childName = "f1",
					pos = {
						x = -345.23,
						y = 153.52
					}
				},
				children = {}
			},
			{
				name = "bg1",
				cType = "Sprite",
				params = {
					image = "bz_49.png",
					anchor = {
						x = 0.5,
						y = 0
					},
					pos = {
						x = 0,
						y = 0
					}
				},
				children = {}
			},
			{
				name = "untitled50",
				cType = "Sprite",
				custom = {
					{
						value = 5,
						name = "flowerId",
						type = "integer"
					}
				},
				params = {
					image = "bz_47.png",
					childName = "f5",
					pos = {
						x = 294.2,
						y = 300.55
					}
				},
				children = {}
			},
			{
				name = "untitled47",
				cType = "Sprite",
				custom = {
					{
						value = 2,
						name = "flowerId",
						type = "integer"
					}
				},
				params = {
					image = "bz_45.png",
					childName = "f2",
					pos = {
						x = -138.28,
						y = 306.17
					}
				},
				children = {}
			},
			{
				name = "bg2",
				cType = "Sprite",
				params = {
					image = "bz_42.png",
					anchor = {
						x = 0.5,
						y = 0
					},
					pos = {
						x = -244.37,
						y = 0
					}
				},
				children = {}
			},
			{
				name = "bg5",
				cType = "Sprite",
				params = {
					image = "bz_39.png",
					anchor = {
						x = 0.5,
						y = 0
					},
					pos = {
						x = 238.29,
						y = 44.46
					}
				},
				children = {}
			},
			{
				name = "untitled49",
				cType = "Sprite",
				custom = {
					{
						value = 4,
						name = "flowerId",
						type = "integer"
					}
				},
				params = {
					image = "bz_40.png",
					childName = "f4",
					pos = {
						x = 130.37,
						y = 204.37
					}
				},
				children = {}
			},
			{
				name = "bg3",
				cType = "Sprite",
				params = {
					image = "bz_38.png",
					anchor = {
						x = 0.5,
						y = 0
					},
					pos = {
						x = 0,
						y = 0
					}
				},
				children = {}
			},
			{
				name = "untitled48",
				cType = "Sprite",
				custom = {
					{
						value = 3,
						name = "flowerId",
						type = "integer"
					}
				},
				params = {
					image = "bz_36.png",
					childName = "f3",
					pos = {
						x = -64.75,
						y = 177.54
					}
				},
				children = {}
			},
			{
				name = "untitled51",
				cType = "Sprite",
				custom = {
					{
						value = 6,
						name = "flowerId",
						type = "integer"
					}
				},
				params = {
					image = "bz_43.png",
					childName = "f6",
					pos = {
						x = 313.71,
						y = 111.1
					}
				},
				children = {}
			},
			{
				name = "bg4",
				cType = "Sprite",
				params = {
					image = "bz_33.png",
					anchor = {
						x = 0.5,
						y = 0
					},
					pos = {
						x = -37.14,
						y = 0
					}
				},
				children = {}
			}
		}
	},
	{
		name = "untitled1",
		cType = "Node",
		params = {
			posApt = 1,
			scaleApt = 2,
			pos = {
				x = 0,
				y = 640
			}
		},
		children = {
			{
				name = "untitled2",
				cType = "Button",
				params = {
					clickAction = "onExitLayer",
					image = "c_1.png",
					anchor = {
						x = 0,
						y = 1
					},
					pos = {
						x = 0,
						y = 0
					}
				},
				children = {}
			},
			{
				name = "untitled3",
				cType = "Sprite",
				params = {
					image = "bp_1.png",
					pos = {
						x = 135.9,
						y = -26.51
					}
				},
				children = {}
			}
		}
	},
	{
		name = "untitled6",
		cType = "Node",
		params = {
			posApt = 1,
			scaleApt = 2,
			pos = {
				x = 1136,
				y = 640
			}
		},
		children = {
			{
				name = "untitled7",
				cType = "TopResourceNode",
				params = {
					anchor = {
						x = 1,
						y = 1
					},
					moduleIdList = {
						1111,
						1112,
						1114
					},
					pos = {
						x = 0,
						y = 0
					}
				},
				children = {}
			},
			{
				name = "untitled26",
				cType = "Button",
				params = {
					image = "tb_gn_24.png",
					clickAction = "onAttrLook",
					pos = {
						x = -100,
						y = -130
					}
				},
				children = {}
			}
		}
	},
	{
		name = "mTabNode",
		cType = "Node",
		params = {
			posApt = 1,
			scaleApt = 2,
			pos = {
				x = 0,
				y = 320
			}
		},
		children = {
			{
				name = "mSelectSprite",
				cType = "Scale9Sprite",
				params = {
					image = "c_6.png",
					anchor = {
						x = 0,
						y = 0.5
					},
					pos = {
						x = 0,
						y = 120
					}
				},
				children = {}
			},
			{
				name = "untitled12",
				cType = "Button",
				custom = {
					{
						value = 3,
						name = "campId",
						type = "integer"
					}
				},
				params = {
					image = "tj_01.png",
					clickAction = "onCampCallback",
					pos = {
						x = 50,
						y = 120
					}
				},
				children = {
					{
						name = "untitled52",
						cType = "RedDot",
						params = {
							subKey = "GuildTalent_3",
							moduleId = 4615
						},
						children = {}
					}
				}
			},
			{
				name = "untitled15",
				cType = "Button",
				custom = {
					{
						value = 2,
						name = "campId",
						type = "integer"
					}
				},
				params = {
					image = "tj_02.png",
					clickAction = "onCampCallback",
					pos = {
						x = 50,
						y = 0
					}
				},
				children = {
					{
						name = "untitled53",
						cType = "RedDot",
						params = {
							subKey = "GuildTalent_2",
							moduleId = 4615
						},
						children = {}
					}
				}
			},
			{
				name = "untitled16",
				cType = "Button",
				custom = {
					{
						value = 1,
						name = "campId",
						type = "integer"
					}
				},
				params = {
					image = "tj_03.png",
					clickAction = "onCampCallback",
					pos = {
						x = 50,
						y = -120
					}
				},
				children = {
					{
						name = "untitled54",
						cType = "RedDot",
						params = {
							subKey = "GuildTalent_1",
							moduleId = 4615
						},
						children = {}
					}
				}
			}
		}
	},
	{
		name = "untitled17",
		cType = "Node",
		params = {
			posApt = 1,
			scaleApt = 2,
			pos = {
				x = 568,
				y = 640
			}
		},
		children = {
			{
				name = "untitled19",
				cType = "Scale9Sprite",
				params = {
					image = "xkzj_29.png",
					pos = {
						x = 0,
						y = -120
					}
				},
				children = {
					{
						name = "mFloorLabel",
						cType = "Label",
						params = {
							pos = {
								x = 95,
								y = 21
							},
							text = TR("第一层")
						},
						children = {}
					}
				}
			}
		}
	},
	{
		name = "untitled27",
		cType = "Node",
		params = {
			posApt = 1,
			scaleApt = 2,
			pos = {
				x = 568,
				y = 0
			}
		},
		children = {
			{
				name = "mResBg",
				cType = "Scale9Sprite",
				params = {
					image = "c_93.png",
					pos = {
						x = 0,
						y = 100
					}
				},
				children = {
					{
						name = "untitled36",
						cType = "ResLabel",
						params = {
							num = 500,
							modelId = 1115,
							hide = true,
							pos = {
								x = 179,
								y = 16
							}
						},
						children = {}
					}
				}
			},
			{
				name = "untitled32",
				cType = "Button",
				params = {
					clickAction = "onLvupCallback",
					image = "c_32.png",
					pos = {
						x = 0,
						y = 40
					},
					size = {
						width = 160,
						height = 50
					},
					titleText = TR("修炼")
				},
				children = {}
			}
		}
	},
	{
		name = "mAttrParent",
		cType = "Node",
		params = {
			posApt = 1,
			scaleApt = 2,
			pos = {
				x = 568,
				y = 0
			}
		},
		children = {
			{
				name = "AttrTeamNode",
				cType = "TemplateNode",
				custom = {
					{
						value = "untitled35-text",
						name = "attrStr",
						type = "string"
					}
				},
				params = {
					pos = {
						x = -29.74,
						y = 354.05
					}
				},
				children = {
					{
						name = "untitled34",
						cType = "Scale9Sprite",
						params = {
							image = "bz_18.png",
							pos = {
								x = 0,
								y = 0
							}
						},
						children = {}
					},
					{
						name = "untitled35",
						cType = "Label",
						params = {
							pos = {
								x = 0,
								y = 0
							},
							text = TR("护甲+25")
						},
						children = {}
					}
				}
			}
		}
	}
}
slot0.ctor = function (slot0, slot1)
	slot0.mCurCamp = CampType.eYiTian
	slot0.mIsAction = false

	slot0.super.ctor(slot0)
	slot0.initUI(slot0)
	slot0.requestInfo(slot0)

	return 
end
slot0.initUI = function (slot0)
	slot0.createUITree(slot0)

	return 
end
slot0.refreshUI = function (slot0)
	slot0.refreshCampBtns(slot0)
	slot0.refreshAttr(slot0)
	slot0.refreshUseRes(slot0)
	slot0.refreshFlowers(slot0)
	slot0.refreshStep(slot0)

	return 
end
slot0.getNextLv = function (slot0)
	slot1 = 1
	slot2 = 0

	if slot0.mGuildTalentInfo[tostring(slot0.mCurCamp)] and next(slot3) then
		slot1 = slot3.Step
		slot2 = slot3.Lv + 1

		if not GuildtalentLvupConfig.items[slot0.mCurCamp][slot3.Step][slot3.Lv + 1] and GuildtalentLvupConfig.items[slot0.mCurCamp][slot3.Step + 1] then
			slot1 = slot3.Step + 1
			slot2 = 1
		end
	end

	return slot1, slot2
end
slot0.refreshAttr = function (slot0)
	slot1 = {
		cc.p(-328, 167),
		cc.p(-150, 334),
		cc.p(-80, 195),
		cc.p(120, 185),
		cc.p(320, 272),
		cc.p(330, 119)
	}

	slot0.mAttrParent:removeAllChildren()

	for slot7, slot8 in ipairs(slot3) do
		slot10 = slot0.createLayoutTemplateNode(slot0, "AttrTeamNode", {
			attrStr = Utility.analysisStrAttrToFromat(slot8.attrStr, "%s+%s")
		})

		slot10.setPosition(slot10, slot1[slot7])
		slot0.mAttrParent:addChild(slot10)
	end

	return 
end
slot0.getCurNeedRes = function (slot0)
	if not slot0.mGuildTalentInfo[tostring(slot0.mCurCamp)] or not next(slot1) then
		return Utility.analysisStrResList(GuildtalentLvupConfig.items[slot0.mCurCamp][1][1].needResource)
	else
		if GuildtalentLvupConfig.items[slot0.mCurCamp][slot1.Step][slot1.Lv + 1] then
			return Utility.analysisStrResList(slot3.needResource)
		end

		slot2 = 1

		if GuildtalentLvupConfig.items[slot0.mCurCamp][slot1.Step + 1] then
			return Utility.analysisStrResList(GuildtalentLvupConfig.items[slot0.mCurCamp][slot4][slot2].needResource)
		end

		return nil
	end

	return 
end
slot0.refreshUseRes = function (slot0)
	slot0.mResBg:removeAllChildren()

	if slot0.getCurNeedRes(slot0) then
		slot3 = (slot0.mResBg:getContentSize().width - #slot1*135)*0.5

		for slot7, slot8 in ipairs(slot1) do
			slot11 = UIWrap.newControl("ResLabel", {
				fontSize = 18,
				modelId = slot8.resourceId,
				num = slot8.num,
				pos = cc.p(slot3 + (slot7 - 0.9)*slot2, 15),
				color = (slot8.num <= Resource.getCount(slot8.resourceId) and cc.c3b(255, 255, 255)) or cc.c3b(192, 65, 65)
			})

			slot0.mResBg:addChild(slot11)
			slot11.setString(slot11, slot8.num, nil, slot9)
		end
	else
		slot0.mResBg:addChild(UIWrap.newControl("Label", {
			text = TR("已满级"),
			pos = cc.p(200, 16)
		}))
	end

	return 
end
slot0.refreshCampBtns = function (slot0)
	slot1 = {
		[CampType.eSheDiao] = {
			"tj_03.png",
			"tj_04.png"
		},
		[CampType.eShenDiao] = {
			"tj_02.png",
			"tj_05.png"
		},
		[CampType.eYiTian] = {
			"tj_01.png",
			"tj_06.png"
		}
	}

	for slot6, slot7 in pairs(slot2) do
		slot7.loadTextures(slot7, (slot7.campId == slot0.mCurCamp and slot1[slot7.campId][1]) or slot1[slot7.campId][2])

		if slot7.campId == slot0.mCurCamp then
			slot0.mSelectSprite:setPositionY(slot7.getPositionY(slot7))
		end
	end

	return 
end
slot0.refreshStep = function (slot0)
	slot0.mFloorLabel:setString(TR("第%s层", Utility.getChineseNum(slot1)))

	return 
end
slot0.refreshFlowers = function (slot0, slot1)
	slot2 = {
		{
			"bz_35.png",
			"bz_34.png"
		},
		{
			"bz_46.png",
			"bz_45.png"
		},
		{
			"bz_37.png",
			"bz_36.png"
		},
		{
			"bz_41.png",
			"bz_40.png"
		},
		{
			"bz_48.png",
			"bz_47.png"
		},
		{
			"bz_44.png",
			"bz_43.png"
		}
	}
	slot3, slot4 = slot0.getNextLv(slot0)
	slot5 = slot4 - 1

	for slot10, slot11 in pairs(slot6) do
		slot11.setTexture(slot11, (slot11.flowerId <= slot5 and slot2[slot11.flowerId][1]) or slot2[slot11.flowerId][2])
	end

	if slot1 then
		for slot10, slot11 in pairs(slot6) do
			slot11.setTexture(slot11, slot2[slot11.flowerId][1])
		end
	end

	return 
end
slot0.onExitLayer = function (slot0)
	LayerManager.removeLayer(slot0)

	return 
end
slot0.onAttrLook = function (slot0)
	LayerManager.addLayer({
		cleanUp = false,
		name = "guild.GuildTalentAttrLayer",
		zOrder = Enums.ZOrderType.ePopLayer,
		data = {
			guildTalentAttrs = slot0.mGuildTalentAttrs
		}
	})

	return 
end
slot0.onCampCallback = function (slot0, slot1)
	slot0.mCurCamp = slot1.campId

	slot0.refreshUI(slot0)

	return 
end
slot0.onLvupCallback = function (slot0)
	if slot0.mIsAction then
		return 
	end

	if not slot0.getCurNeedRes(slot0) then
		ui.showFlashView(TR("该阵营已满级，请修炼其他阵营"))

		return 
	end

	for slot5, slot6 in pairs(slot1) do
		if not Resource.isEnough(slot6.resourceId, slot6.num) then
			return 
		end
	end

	slot0.requestUpLv(slot0)

	return 
end
slot0.lvUpAction = function (slot0)
	slot1 = false

	if slot0.mGuildTalentInfo[tostring(slot0.mCurCamp)] and next(slot2) and not GuildtalentLvupConfig.items[slot0.mCurCamp][slot2.Step][slot2.Lv + 1] and GuildtalentLvupConfig.items[slot0.mCurCamp][slot2.Step + 1] then
		slot1 = true
	end

	if slot1 then
		slot0.refreshFlowers(slot0, true)
	else
		slot0.refreshUI(slot0)
	end

	slot0.mIsAction = true

	MqAudio.playEffect("yuchushui.mp3")

	slot0.mYuEff = UIWrap.newControl("Effect", {
		loop = false,
		animation = "yu",
		dataFile = "effect_shuimoshuxingshengji",
		complete = function ()
			MqAudio.playEffect("yurushui.mp3")

			MqAudio.playEffect.mIsAction = false

			MqAudio.playEffect.mYuEff:removeFromParent()

			MqAudio.playEffect.mYuEff.removeFromParent.mYuEff = nil

			if nil then
				slot0:refreshUI()
			end

			return 
		end
	})

	slot0.mYuEff:setPosition(0, 320)
	slot0.mFlowersNode:addChild(slot0.mYuEff)

	return 
end
slot0.requestInfo = function (slot0)
	slot0.socketRequest(slot0, {
		methodName = "GetInfo",
		moduleName = "GuildTalent",
		methodData = {},
		successCallback = function (slot0)
			slot0.mGuildTalentInfo = slot0.GuildTalentInfo
			slot0.mGuildTalentAttrs = slot0.GuildTalentAttrs

			slot0:refreshUI()

			return 
		end
	})

	return 
end
slot0.requestUpLv = function (slot0)
	slot0.socketRequest(slot0, {
		methodName = "Practice",
		moduleName = "GuildTalent",
		methodData = {
			slot0.mCurCamp
		},
		successCallback = function (slot0)
			slot0.mGuildTalentInfo = slot0.GuildTalentInfo
			slot0.mGuildTalentAttrs = slot0.GuildTalentAttrs

			slot0:lvUpAction()

			return 
		end
	})

	return 
end

return slot0
